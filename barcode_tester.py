# Sample data
products = [
    {
        "product": "LEGO The Hobbit",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed, the case and sealing is little damaged please look at pictures ",
        "inserts": "yes",
        "sku": "EB056001",
        "upc": "5051892166256",
        "list_price": "15.99",
        "title_change": "Brand New Damaged",
    },
    {
        "product": "Unravel: Yarny Bundle",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056002",
        "upc": "5030933123427",
        "list_price": "49.99",
        "title_change": "Brand New",
    },
    {
        "product": "Slain: Back From Hell",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory seealed with a small tear in the plastic on top, please look at pictures",
        "inserts": "yes",
        "sku": "EB056003",
        "upc": "5060264371020",
        "list_price": "49.99",
        "title_change": "Brand New Plastic Tear",
    },
    {
        "product": "Battleborn",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056004",
        "upc": "5026555418089",
        "list_price": "9.99",
        "title_change": "Brand New",
    },
    {
        "product": "Neverwinter Nights: Enhanced Edition",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed with a tear on the plastic please look at pictures",
        "inserts": "yes",
        "sku": "EB056005",
        "upc": "811949031396",
        "list_price": "13.99",
        "title_change": "Brand New Plastic Tear",
    },
    {
        "product": "Uncharted 4 A Thief's End",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed with a sticker on the back by the barcode",
        "inserts": "yes",
        "sku": "EB056006",
        "upc": "711719454113",
        "list_price": "18.99",
        "title_change": "Brand New",
    },
    {
        "product": "Shadow of the Tomb Raider [Definitive Edition]",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056007",
        "upc": "5021290085879",
        "list_price": "19.99",
        "title_change": "Brand New",
    },
    {
        "product": "Ancestors Legacy: Conqueror's Edition",
        "main_category": "video games",
        "sub_category": "PAL Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056008",
        "upc": "8437020062015",
        "list_price": "49.99",
        "title_change": "Brand New",
    },
    {
        "product": "SteamWorld Collection",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056009",
        "upc": "887195000271",
        "list_price": "34.95",
        "title_change": "Brand New",
    },
    {
        "product": "Destiny: Taken King Legendary Edition",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056010",
        "upc": "047875874428",
        "list_price": "14.99",
        "title_change": "Brand New",
    },
    {
        "product": "MLB 14: The Show",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056011",
        "upc": "711719043430",
        "list_price": "9.49",
        "title_change": "Brand New",
    },
    {
        "product": "Detroit Become Human",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056012",
        "upc": "711719506140",
        "list_price": "21.99",
        "title_change": "Brand New",
    },
    {
        "product": "Spyro Reignited Trilogy",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056013",
        "upc": "047875882379",
        "list_price": "19.99",
        "title_change": "Brand New",
    },
    {
        "product": "Subnautica",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056014",
        "upc": "850942007571",
        "list_price": "19.99",
        "title_change": "Brand New",
    },
    {
        "product": "Natural Doctrine",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed, with a tear on the plastic along the top, please look at pictures",
        "inserts": "yes",
        "sku": "EB056015",
        "upc": "813633014036",
        "list_price": "19.99",
        "title_change": "Brand New Plastic Tear",
    },
    {
        "product": "Pure Chess",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056016",
        "upc": "696055249343",
        "list_price": "29.99",
        "title_change": "Brand New",
    },
    {
        "product": "Deus Ex: Mankind Divided [Day One Edition]",
        "main_category": "video games",
        "sub_category": "Playstation 4",
        "packaging": "original",
        "condition": "brand new",
        "condition_notes": "brand new factory sealed",
        "inserts": "yes",
        "sku": "EB056017",
        "upc": "662248916361",
        "list_price": "9.99",
        "title_change": "Brand New",
    },
]
import barcode
from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas
from reportlab.lib.units import mm
from reportlab.pdfbase.pdfmetrics import stringWidth

# Your product data here in the 'products' list


def generate_barcode(sku, file_format="png"):
    code = barcode.get("code128", sku, writer=barcode.writer.ImageWriter())
    file_name = sku
    file_name = file_name.replace(".", "-")
    barcode_file = code.save(
        sku
    )  # This will save the barcode image in the current directory
    return barcode_file


def create_pdf(
    products, products_per_row=3, rows_per_page=5, font_name="Helvetica", font_size=8
):
    c = canvas.Canvas("product_barcodes.pdf", pagesize=letter)
    width, height = letter  # Width and height of the paper

    card_width = width / products_per_row
    card_height = height / rows_per_page

    c.setFont(font_name, font_size)

    # Adjust barcode size
    barcode_width = 40 * mm
    barcode_height = 10 * mm

    for index, product in enumerate(products):
        col = index % products_per_row
        row = index // products_per_row % rows_per_page

        x = col * card_width
        y = height - ((row + 1) * card_height)

        # Calculate positions
        barcode_x = x + (card_width - barcode_width) / 3
        top_barcode_y = (
            y + card_height - barcode_height - 5 * mm
        )  # Adjust top margin for SKU barcode
        bottom_barcode_y = (
            top_barcode_y - barcode_height - 5 * mm
        )  # Position for the price barcode, adjust gap

        # Generate and draw the barcode for SKU
        sku_barcode_filename = generate_barcode(product["sku"])
        c.drawImage(
            sku_barcode_filename,
            barcode_x,
            top_barcode_y,
            width=barcode_width,
            height=barcode_height,
        )

        # Generate and draw the barcode for list price
        price_barcode_filename = generate_barcode(product["list_price"])
        c.drawImage(
            price_barcode_filename,
            barcode_x,
            bottom_barcode_y,
            width=barcode_width,
            height=barcode_height,
        )

        # Position for the key-value pairs
        text_x = x + 10 * mm
        text_y = (
            bottom_barcode_y - font_size * 2
        )  # Adjust space between barcode and text

        # Draw the key-value pairs
        for key in ["product", "condition", "title_change", "list_price"]:
            value = product.get(key, "")
            truncated_value = (value[:20] + "...") if len(value) > 20 else value
            text_line = f"{key.replace('_', ' ').title()}: {truncated_value}"
            c.drawString(text_x, text_y, text_line)
            text_y -= font_size * 1.2  # Adjust line height

        # Check if we need to start a new page
        if (index + 1) % (products_per_row * rows_per_page) == 0 and index + 1 != len(
            products
        ):
            c.showPage()

    c.save()


create_pdf(products)


# Replace 'products' with your actual products list
create_pdf(products)


# create_pdf(products)
